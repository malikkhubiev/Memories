"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[770],{7707:(t,e,n)=>{n.d(e,{F:()=>u});var r=n(6540);const o={plug:{width:"25px"}};var a=n(9067),u=function(){return r.createElement(a.A,{sx:o.plug})}},9571:(t,e,n)=>{n.d(e,{c:()=>m});var r=n(9067),o=n(1104),a=n(6990),u=n(6540);const c={defaultBox:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},input:{margin:"0",width:{xs:"70%",md:"80%"}},button:{width:{xs:"30%",md:"20%"},height:"76px"}};var i=n(2389),l=n(6248),s=n(4540),f=function(){return f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},f.apply(this,arguments)},m=function(t){var e=t.text,n=t.placeholder,m=t.addInputCallback,d=t.isMultiline,p=t.label,h=t.sx,g=t.lines,E=t.inputTestId,x=t.buttonTestId,b=t.buttonText,v=t.icon,y=t.iconExtra,w=(0,u.useState)(e),S=w[0],k=w[1];(0,i.Bd)("authorized").t,(0,u.useEffect)((function(){(0,l.o)("authorized")}),[]),(0,u.useEffect)((function(){k((function(t){return e}))}),[e]);var A=function(){m(S)},O=c.defaultBox;return h&&(O=f(f({},O),h)),u.createElement(r.A,{sx:O},u.createElement(o.A,{sx:c.input,"data-testid":E,multiline:d,maxRows:g||null,label:p,autoComplete:"off",placeholder:n||null,value:S,onChange:function(t){k((function(e){return t.target.value}))},onKeyPress:function(t){"Enter"===t.key&&(A(),t.preventDefault())}}),u.createElement(a.A,{sx:c.button,"data-testid":x,onClick:A,variant:"contained"},v?u.createElement(s.p,{extra:y&&y,type:v}):{buttonText:b}))}},4645:(t,e,n)=>{n.d(e,{A:()=>o});var r=n(6540);const o=function(t,e){var n=(0,r.useState)(!1),o=n[0],a=(n[1],(0,r.useState)(null)),u=a[0],c=a[1],i=(0,r.useState)(""),l=i[0],s=i[1],f=(0,r.useRef)(null);(0,r.useEffect)((function(){return o||(f.current=new WebSocket("wss://memories-3-ov6w.onrender.com/"),f.current.onopen=function(){f.current.send(JSON.stringify({token:localStorage.getItem("token"),type:t,imageId:e,method:"connection"})),s("Соединение открыто")},f.current.onclose=function(){return s("Соединение закрыто")},m()),function(){return f.current.close()}}),[f,o]);var m=(0,r.useCallback)((function(){f.current&&(f.current.onmessage=function(t){if(!o){var e=JSON.parse(t.data);c(e)}})}),[o]);return{data:u,sendData:function(t){f.current&&"Соединение открыто"===l&&f.current.send(JSON.stringify({token:localStorage.getItem("token"),method:"message",data:t}))}}}},3770:(t,e,n)=>{n.r(e),n.d(e,{default:()=>F,transformNumber:()=>N});var r=n(4675),o=n(9067),a=n(6540),u=n(8106),c=n(1469),i=n(3222),l=n(7707),s=n(4073),f=n(5834),m=n(9753),d=n(407),p=n(9379),h=n(5771),g=n(8890);const E={comment:{width:"100%",margin:"25px 0"},line:{width:"100%",display:"flex",justifyContent:"flex-start",alignItems:"center"},body:{width:"92%",textIndent:"30px",fontSize:"20px",marginTop:"10px"},like:{width:"8%"}};var x=n(2389),b=n(6248),v=[{id:1,props:{body:"comment_delete_button",icon:"delete"}}],y=function(t){var e=t.id,n=t.authorId,r=t.authorName,u=t.isOwn,c=t.avatar,i=t.menuOptionsHandlerCallback,l=t.createdAt,y=t.text,w=t.numberOfLikes,S=t.isLiked,k=(0,a.useState)([]),A=k[0],O=k[1],I=(0,x.Bd)("authorized").t;(0,a.useEffect)((function(){(0,b.o)("authorized");var t=JSON.parse(JSON.stringify(v));t.forEach((function(t){t.props.body=I(t.props.body)})),O((function(e){return t}))}),[]);var C=(0,a.useState)(S),N=C[0],F=C[1],T=(0,a.useState)(w),_=T[0],J=T[1],j=(0,d.us)()[0],R=(0,d.XR)()[0],z=(0,m.j)();return a.createElement(o.A,{sx:E.comment},a.createElement(g.Ai,{sx:{flexDirection:"column"}},a.createElement(a.Fragment,null,a.createElement(p.h,{optionActionCallback:function(t){i(e)},menuOptions:A,authorId:n,authorName:r,isOwn:u,component:"comment",avatar:c,createdAt:l}),a.createElement(o.A,{sx:E.line},a.createElement(s.A,{variant:"body2",sx:E.body},y),a.createElement(o.A,{sx:E.like},a.createElement(h.A,{isLiked:N,like:function(){z((0,f.F6)(!0)),j({commentId:e}).unwrap().then((function(){F((function(t){return!0})),J((function(t){return"".concat(+t+1)}))})).catch((function(t){return z((0,f.g)(t.data.message))})),z((0,f.F6)(!1))},unLike:function(){z((0,f.F6)(!0)),R({commentId:e}).unwrap().then((function(){F((function(t){return!1})),J((function(t){return"".concat(+t-1)}))})).catch((function(t){return z((0,f.g)(t.data.message))})),z((0,f.F6)(!1))},numberOfLikes:_}))))))},w=n(4745),S=n(9571),k=n(1467),A=n(4645);const O={comments:function(t){return{width:"100%",padding:"25px",overflowY:"scroll",borderTop:"1px solid ".concat(t.palette.primary.main),display:"flex",justifyContent:"flex-start",alignItems:"center",flexDirection:"column"}},column_wrap:{paddingBottom:"80px"},iconExtra:function(t){return{fill:"#fff"}}};var I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},I.apply(this,arguments)},C=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,a=e.length;o<a;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},N=function(t){var e=String(t);return t>999999?e="".concat(t/1e6,"M"):t>9999&&(e="".concat(t/1e3,"K")),e};const F=function(){var t=(0,x.Bd)("authorized").t;(0,a.useEffect)((function(){(0,b.o)("authorized")}),[]);var e=+(0,u.g)().imageId.slice(1),n="true"===(0,u.g)().isCommentSectionOpened.slice(1),s=(0,a.useState)(null),p=s[0],h=s[1],E=(0,a.useState)([]),v=E[0],F=E[1],T=(0,k.oW)()[0],_=(0,m.j)();(0,a.useEffect)((function(){e&&(_((0,f.F6)(!0)),T({imageId:e}).unwrap().then((function(t){F((function(e){return t.comments}));var e=JSON.parse(JSON.stringify(t));delete e.comments,h((function(t){return e}))})).catch((function(t){return _((0,f.g)(t.data.message))})),_((0,f.F6)(!1)))}),[e]);var J=(0,A.A)("comments",e),j=J.data,R=J.sendData;(0,a.useEffect)((function(){if(j)if(v){F((function(t){return C(C([],t,!0),[j],!1)}));var t=v.length+1,e=N(t);h((function(t){return I(I({},t),{numberOfComments:e})}))}else F((function(t){return[j]})),h((function(t){return I(I({},t),{numberOfComments:"1"})}))}),[j]);var z=(0,d.yq)()[0],M=(0,d.yy)()[0],B=(0,a.useRef)(),D=(0,a.useState)(n),L=D[0],X=D[1],G=(0,a.useState)(""),P=G[0],H=G[1],K=function(t){_((0,f.F6)(!0)),M({commentId:t}).unwrap().then((function(e){var n=JSON.parse(JSON.stringify(v));void 0!==(n=n.filter((function(e){return e.id!==t})))[0]?F((function(t){return n})):F((function(t){return[]}));var r=n.length,o=N(r);h((function(t){return I(I({},t),{numberOfComments:o})}))})).catch((function(t){return _((0,f.g)(t.data.message))})),_((0,f.F6)(!1))};(0,a.useEffect)((function(){window.scrollTo(0,Number.MAX_SAFE_INTEGER),(null==B?void 0:B.current)&&(B.current.scrollTop=Number.MAX_SAFE_INTEGER)}),[v]);var W=(0,r.A)();return a.createElement(c.R,{sx:O.column_wrap},a.createElement(i.z,{isShowing:!1},a.createElement(l.F,null),a.createElement(l.F,null)),a.createElement(g.J,null,p?a.createElement(w._,I({commentsCallback:function(t){X((function(e){return t})),t&&setTimeout((function(){window.scrollTo(0,Number.MAX_SAFE_INTEGER),B&&B.current&&(B.current.scrollTop=Number.MAX_SAFE_INTEGER)}),10)},isCommentSectionOpened:L},p)):"",L?a.createElement(a.Fragment,null,a.createElement(o.A,{ref:B,sx:O.comments(W)},v&&v.length?v.map((function(t){return a.createElement(y,I({menuOptionsHandlerCallback:K,key:t.id},t))})):""),a.createElement(S.c,{lines:3,isMultiline:!0,text:P,addInputCallback:function(t){t&&""!==t.trim()&&p.id&&(H((function(e){return t})),_((0,f.F6)(!0)),z({imageId:p.id,text:t}).unwrap().then((function(t){H((function(t){return""})),R({type:"comments",body:I({imageId:p.id},t)})})).catch((function(t){return _((0,f.g)(t.data.message))})),_((0,f.F6)(!1)))},buttonText:t("post_buttonText"),placeholder:t("post_placeholder"),icon:"send",iconExtra:O.iconExtra(W)})):""))}}}]);