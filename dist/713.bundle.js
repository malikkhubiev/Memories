"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[713],{2458:(n,e,t)=>{t.d(e,{Y:()=>g});var r=t(6540),a=t(3288),i=t(5834),u=t(9753),c=t(1467),o=t(8890),f=t(4745),s=function(){return s=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n},s.apply(this,arguments)},l={},d={},m={},g=(0,r.memo)((function(n){var e=n.images,t=n.idOfSelected,g=n.onScrollHomePageFunc,h=(0,r.useState)(e),p=h[0],v=h[1],w=(0,a.o)(null),S=w.data,F=w.isLoading,E=w.error,O=(0,a.G$)()[0],b=(0,u.j)();(0,r.useEffect)((function(){E&&b((0,i.g)(E.data.message))}),[E]),(0,r.useEffect)((function(){b(F?(0,i.F6)(!0):(0,i.F6)(!1))}),[F]),(0,r.useEffect)((function(){S&&S.forEach((function(n){d[n.name]=n.rating}))}),[S]),(0,r.useEffect)((function(){v((function(n){return e}))}),[e]);var k=window.innerHeight,y=null,I={},N=(0,r.useCallback)((function(n,e,t){I[n]=e,t&&(y=t)}),[]),j=null,A=0,C=0,J=(0,r.useCallback)((function(){var n,e=Math.round((C-A)/1e3);if(m){var t=m[j]||0;m=s(s({},m),((n={})[j]=t+e,n))}}),[]);(0,r.useEffect)((function(){p&&p.length&&p.forEach((function(n){l[n.id]=n.tags.map((function(n){return n.name}))}))}),[p]);var H=(0,c.Sx)()[0];(0,r.useEffect)((function(){return window.onscroll=function(){g&&g();for(var n=window.scrollY+k/2,e=0,t=Object.entries(I);e<t.length;e++){var r=t[e],a=r[0],i=r[1];Math.abs(n-i)<y/2&&j!==+a&&(null===j?(j=+a,A=Date.now()):(C=Date.now(),J(),j=+a,A=Date.now()))}},function(){Object.keys(m).forEach((function(n){l[n].forEach((function(e){d[e]||(d[e]=0),d[e]=d[e]+m[n]}))}));var n=[];Object.entries(d).forEach((function(e){n.push({name:e[0],rating:e[1]})})),b((0,i.F6)(!0)),O({preferences:n,isFirstTime:!1}).unwrap().catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1));var e=Object.keys(m).map((function(n){return+n}));b((0,i.F6)(!0)),H({imagesIds:e}).unwrap().then((function(){return b((0,i.F6)(!1))}))}}),[]);var P=(0,c.wc)()[0],D=(0,c.D8)()[0],x=(0,c.nH)()[0],L=(0,c.Ws)()[0],Y=(0,c.Fj)()[0],G=(0,c.UK)()[0],T=function(n,e){"Save"===e?(b((0,i.F6)(!0)),P({imageId:n}).unwrap().then((function(e){v((function(e){var t=JSON.parse(JSON.stringify(p));return t.forEach((function(e){e.id===n&&(e.isSaved=!0)})),t}))})).catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1))):"Unsave"===e?(b((0,i.F6)(!0)),D({imageId:n}).unwrap().then((function(e){v((function(e){var t=JSON.parse(JSON.stringify(p));return t.forEach((function(e){e.id===n&&(e.isSaved=!1)})),t}))})).catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1))):"Hide"===e?(b((0,i.F6)(!0)),x({imageId:n}).unwrap().then((function(e){v((function(e){return e.filter((function(e){return e.id!==n}))}))})).catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1))):"Delete"===e?(b((0,i.F6)(!0)),L({imageId:n}).unwrap().then((function(e){v((function(e){return e.filter((function(e){return e.id!==n}))}))})).catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1))):"Not interested"===e?(b((0,i.F6)(!0)),Y({imageId:n}).unwrap().then((function(){v((function(e){return e.filter((function(e){return e.id!==n}))}))})).catch((function(n){return b((0,i.g)(n.data.message))})),b((0,i.F6)(!1))):"Show"===e&&(b((0,i.F6)(!0)),G({imageId:n}),b((0,i.F6)(!1)))};return r.createElement(o.J,null,p&&p.map((function(n){return r.createElement(f._,{key:n.id,menuOptionsHandlerCallback:T,setImagePosition:N,idOfSelected:t,authorId:n.authorId,authorName:n.authorName,isOwn:n.isOwn,avatar:n.avatar,id:n.id,createdAt:n.createdAt,numberOfViews:n.numberOfViews,src:n.src,isLiked:n.isLiked,description:n.description,tags:n.tags,numberOfComments:n.numberOfComments,numberOfLikes:n.numberOfLikes,isPrivate:n.isPrivate,isSaved:n.isSaved})})))}))},4645:(n,e,t)=>{t.d(e,{A:()=>a});var r=t(6540);const a=function(n,e){var t=(0,r.useState)(!1),a=t[0],i=(t[1],(0,r.useState)(null)),u=i[0],c=i[1],o=(0,r.useState)(""),f=o[0],s=o[1],l=(0,r.useRef)(null);(0,r.useEffect)((function(){return a||(l.current=new WebSocket("ws://localhost:5000/"),l.current.onopen=function(){l.current.send(JSON.stringify({token:localStorage.getItem("token"),type:n,imageId:e,method:"connection"})),s("Соединение открыто")},l.current.onclose=function(){return s("Соединение закрыто")},d()),function(){return l.current.close()}}),[l,a]);var d=(0,r.useCallback)((function(){l.current&&(l.current.onmessage=function(n){if(!a){var e=JSON.parse(n.data);c(e)}})}),[a]);return{data:u,sendData:function(n){l.current&&"Соединение открыто"===f&&l.current.send(JSON.stringify({token:localStorage.getItem("token"),method:"message",data:n}))}}}},9713:(n,e,t)=>{t.r(e),t.d(e,{HomePage:()=>p,default:()=>v});var r=t(4675),a=t(2320),i=t(6540),u=t(8106),c=t(1469),o=t(2458),f=t(270),s=t(8991),l=t(5834),d=t(9753),m=t(4645);const g=function(n){return{width:"100px",height:"150px",marginTop:"25px"}};var h=t(4540),p=function(){var n=(0,d.j)(),e=(0,f.iV)()[0],t=(0,m.A)("images").data,p=(0,i.useState)([]),v=p[0],w=p[1],S=(0,d.G)((function(n){return(0,l.Ge)(n)})),F=(0,d.G)((function(n){return(0,s.og)(n,S)})),E=(0,u.Zp)();(0,i.useEffect)((function(){t&&(0!==window.scrollY&&(k(!0),N((function(n){return n+1}))),v.length?w((function(n){return function(n,e,t){if(t||2===arguments.length)for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return n.concat(r||Array.prototype.slice.call(e))}([t],n,!0)})):w((function(n){return[t]})))}),[t]);var O=i.useState(!1),b=O[0],k=O[1],y=i.useState(0),I=y[0],N=y[1];(0,i.useEffect)((function(){window.scrollTo(0,0),n((0,l.F6)(!0)),e(null).unwrap().then((function(n){w((function(e){return n}))})).catch((function(e){return n((0,l.g)(e.data.message))})),n((0,l.F6)(!1))}),[]),(0,i.useEffect)((function(){(null==F?void 0:F.isFirstTime)&&E("preferences")}),[F]);var j=(0,r.A)();return i.createElement(c.R,null,i.createElement("div",{id:"logo"},i.createElement(h.g,{fill:j.palette.primary.violet,sx:g(j)})),v.length?i.createElement(i.Fragment,null,i.createElement(a.A,{anchorOrigin:{vertical:"top",horizontal:"center"},open:b,message:"".concat(I," new images")}),i.createElement(o.Y,{onScrollHomePageFunc:function(){0===window.scrollY&&(k(!1),N((function(n){return 0})))},images:v})):i.createElement(i.Fragment,null))};const v=p}}]);